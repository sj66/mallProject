<!--pages/shop/index.wxml-->
<swiper indicator-dots="true" indicator-active-color="#09BB07" autoplay="true" interval="3000" duration="500">
  <block wx:for="{{slide_list}}" wx:key='key'>
    <swiper-item>
      <image src="{{item.img}}" class="slide-image" />
    </swiper-item>
  </block>
</swiper>
<view id="search_box">
  <image style="width: 41rpx;height: 39rpx;margin-right: 12rpx;" src="/public/images/index/icon_scan.png"
    mode="widthFix" bindtap="scanHandle"></image>
  <view id="search" bindtap="openSearch">
    <view id="search_icon" class="van-icon van-icon-search" style="font-size: 18px;"></view>
    <view style="line-height: 28px;font-size: 14px;">请输入药名、厂家、编码</view>
  </view>
  <image style="width: 36rpx;height: 40rpx;margin-left: 12rpx;" src="/public/images/index/icon_notice.png"
    mode="widthFix"></image>
</view>
<view class="list_title">最新推荐</view>
<view class="tui-product-list">
  <view class="tui-product-container">
    <block wx:for="{{list}}" wx:key="index">
      <!--商品列表-->
      <view class="tui-pro-item" hover-class="hover" :hover-start-time="150" bindtap="goDetail"
        data-gid="{{item.goods_id}}" data-qty="{{item.qty}}" data-price="{{item.price}}">
        <view class="tui-flex-list">
          <image src="{{item.img}}" :lazy-load="true" class="tui-pro-img tui-proimg-list" mode="widthFix" />
          <view class="tui-pro-content">
            <view class="tui-pro-tit">{{ item.goods_id }}</view>
            <view class="tui-pro-tit">{{ item.name }}</view>
            <view class="tui-pro-tit list_desc">{{ item.specs }}</view>
            <view class="tui-pro-tit list_company">{{ item.company }}</view>
            <view class="tui-pro-tit list_pack">中包装数：{{ item.mid_pack_num }}<text
                style="padding-left:40rpx">大包装数：{{ item.big_pack_num }}</text></view>
            <view class="tui-pro-tit list_startTime">生产日期：{{ item.prod_date }}</view>
            <view class="tui-pro-tit list_endTime">有效日期：{{ item.valid_date }}</view>
            <view class="tui-pro-price">
              <text class="tui-sale-price" wx:if="{{item.user_status==2}}">￥{{ item.price }}</text>
              <text style="color:#606060;margin:0 20rpx;font-size:28rpx;"
                wx:if="{{item.user_status==2}}">零售:{{ item.retail_price }}</text>
              <text style="color:#606060;font-size:28rpx;"
                wx:if="{{item.user_status==2}}">毛利率:{{  item.price_ratio}}%</text>
              <text class="tui-sale-price"
                wx:if="{{item.user_status!=2}}">{{item.user_status==1?'资质审核后可见':'登录后可见'}}</text>
              <!-- <text class="tui-factory-price">￥{{ item.factory }}</text>
              </view>
               <view class="tui-pro-pay">{{ item.payNum }}人付款</view> -->
              <view class="tui-pro-btn" data-index="{{index}}" data-qty="{{item.qty}}" data-price="{{item.price}}" catchtap="showPopup">下单</view>
            </view>
            <!-- <view class="shopcart_box" bindtap="openAddToCar(index)"><view class="shopcart_box_icon van-icon van-icon-shopping-cart-o" style="font-size: 15px;color: #FFFFFF;"></view> -->
          </view>
          <!-- 缺货   显示已售罄 -->
          <view class="tui-flex-img" wx:if="{{item.qty==0}}">
            <image src="/public/orther_img/vacuity.png"></image>
          </view>
        </view>
        <view wx:if="{{item.promote.end_time}}"
          class="sales_info_box {{item.promote.end_time<1000 ? 'on' : ''}}">
          <view class="sales_info_left">
            <view class="sales_info_icon">买赠</view>
          </view>
          <view class="sales_info_cont">{{item.promote.content}}</view>
          <view class='tui-countdown-content'>
            <van-count-down time="{{ item.promote.end_time }}" format="剩余:DD天HH时mm分ss秒" />
          </view>
        </view>
      </view>
      <!--商品列表-->
    </block>
  </view>
</view>
<view class="loading_box" hidden="{{loading_status}}">
  <van-loading type="spinner" size="24px">加载中...</van-loading>
</view>
<view class="btn_go_car" catchtap="goCar">
  <van-icon wx:if="dot" name="cart" color="#ffffff" size="50rpx" custom-style="position: relative;top:16rpx;" />
  <van-icon wx:else name="cart" color="#ffffff" size="50rpx" custom-style="position: relative;top:16rpx;" dot />
</view>
<van-popup show="{{ show }}" position="bottom" bind:close="closePopup" closeable round>
  <view class="tui-popup-box">
    <view class="tui-product-box tui-recommend">
      <view class="tui-popup-sub">猜您想要的产品</view>
      <view class="tui-product-box tui-goods">
        <image class="tui-popup-img" src="../../public/orther_img/produce_bg.png" />
        <view class="tui-popup-price">
          <view class="tui-pro-title">56333</view>
          <view class="tui-pro-title">清热消炎宁胶囊</view>
          <view class="tui-sub-title tui-size tui-gray">0.5g*36粒</view>
          <view class="tui-sub-title tui-size tui-gray" style="padding: 0;">广东五虎山药业有限公司</view>
          <view class="tui-sub-title tui-pack"><text>中包装数：0</text><text style="padding-left:40rpx">大包装数：230</text>
          </view>
          <view class="tui-sub-title tui-startTime">生产日期：2020-06-20</view>
          <view class="tui-sub-title tui-endTime">有效日期：2022-06-20</view>
          <view class="tui-merge">
            <view class="tui-amount tui-bold">￥13.20</view>
            <view class="tui-button">
              <view class="tui-btn" style="margin-right:20rpx">收藏</view>
              <view class="tui-btn">下单</view>
            </view>
          </view>
        </view>
      </view>
      <view class="sales_info_box">
        <view class="sales_info_left">
          <view class="sales_info_icon">买赠</view>
        </view>
        <view class="sales_info_cont">10瓶送1瓶</view>
        <view class='tui-countdown-content'>
          <van-count-down time="{{time}}" format="剩余:DD天HH时mm分ss秒" />
        </view>
      </view>
    </view>
    <view class="tui-product-box tui-padding">
      <image wx:if="{{order.img==null}}" class="tui-popup-img" src="/public/orther_img/logo.png" />
      <image wx:else class="tui-popup-img" src="{{order.img}}" />
      <view class="tui-popup-price">
        <view class="tui-sub-title tui-pro-title">{{order.goods_id}}</view>
        <view class="tui-sub-title tui-pro-title">{{order.name}}</view>
        <view class="tui-sub-title tui-size tui-gray">{{order.specs}}</view>
        <view class="tui-sub-title tui-size tui-gray" style="padding: 0;">{{order.company}}</view>
        <view class="tui-sub-title tui-pack">中包装数：{{ order.mid_pack_num }}<text
            style="padding-left:40rpx">大包装数：{{ order.big_pack_num }}</text></view>
        <view class="tui-sub-title tui-startTime">生产日期：{{ order.prod_date }}</view>
        <view class="tui-sub-title tui-endTime">有效日期：{{ order.valid_date }}</view>
        <view class="tui-sub-title tui-amount tui-bold">￥{{order.price}}</view>
      </view>
    </view>
    <view wx:if="{{order.promote.end_time}}"
      class="sales_info_box {{order.promote.end_time<1000 ? 'on' : ''}}">
      <view class="sales_info_left">
        <view class="sales_info_icon">买赠</view>
      </view>
      <view class="sales_info_cont">{{order.promote.content}}</view>
      <view class='tui-countdown-content'>
        <van-count-down time="{{ order.promote.end_time }}" format="剩余:DD天HH时mm分ss秒" />
      </view>
    </view>
    <view class="tui-scrollview-box">
      <view class="tui-number-box">
        <view>数量</view>
        <van-stepper value="{{ car_num }}" min="1" max="{{order.qty}}" integer bind:change="numChange" />
      </view>
    </view>
    <view class="tui-operation tui-operation-right tui-right-flex tui-popup-btn">
      <view class="tui-flex-1">
        <van-button custom-style="width:100%;font-size:28rpx;height:68rpx;" round type="warning" bindtap="addToCar">
          加入购物车
        </van-button>
      </view>
      <view class="tui-flex-1">
        <van-button custom-style="width:100%;font-size:28rpx;height:68rpx;" round type="danger" bindtap="goBuy">立即下单
        </van-button>
      </view>
    </view>
  </view>
</van-popup>