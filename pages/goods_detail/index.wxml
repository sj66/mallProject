<!--pages/goods_detail/index.wxml-->
<swiper wx:if="{{data.list.length>0}}" indicator-dots="true" indicator-active-color="#09BB07" autoplay="true"
  interval="3000" duration="500" style="position: relative">
  <block wx:for="{{data.list}}" wx:key='index'>
    <swiper-item>
      <image src="{{item}}" class="slide-image" bindtap="previewImage" data-index="{{index}}" data-url="{{item}}" />
    </swiper-item>
  </block>
</swiper>
<view wx:if="{{data.list.length==0}}" class="slide-image"
  style="position: relative;width:100%;height:520rpx;text-align: center;">
  <image src="https://cdn.hulukeji.cn/images/empty.jpg" style="width:750rpx;height:520rpx;"
    data-url="https://cdn.hulukeji.cn/images/empty.jpg" />
</view>
<!-- iphone分享给朋友 -->
<!-- <view class="share_btn"
  style="position: absolute;top:10rpx;right:10rpx;display: flex;justify-content: flex-end;align-items: center">
  <van-button icon="share" open-type="share" round>分享</van-button>
</view> -->
<!-- 商品详情 -->
<view style="background-color: #FFFFFF;padding-bottom: 20rpx;">
  <view wx:if="{{content}}" class="sales_info_box {{endTime<1000 ? 'on' : ''}}">
    <view class="sales_info_left">
      <view class="sales_info_icon">买赠</view>
    </view>
    <view class="sales_info_cont">{{content}}</view>
    <view class='tui-countdown-content'>
      <van-count-down time="{{ endTime }}" format="剩余:DD天HH时mm分ss秒" />
    </view>
  </view>
  <view class="goods_content">
    <view class="goods_info">
      <view class="tui-pro-pricebox tui-padding">
        <view wx:if="{{data.user_status==2}}" class="tui-pro-price">
          <view wx:if="{{data.name&&data.priceLeft}}">
            <text>￥</text>
            <text class="tui-price">{{data.priceLeft}}</text>
            <text>.{{data.priceRight}}</text>
            <text style="color:#606060;margin:0 20rpx;font-size:28rpx;">零售价:￥{{ data.retail_price }}</text>
            <text style="color:#606060;font-size:28rpx;">毛利率:{{ data.price_ratio}}%</text>
          </view>
          <view wx:if="{{data.name&&!data.priceLeft}}">
            <text>暂无报价</text>
          </view>
        </view>
        <view wx:if="{{data.user_status!=2}}" class="tui-pro-price">
          <view>
            <text>{{data.user_status==1?'资质审核后可见':'登录后可见'}}</text>
          </view>
        </view>
        <!-- <view class="tui-collection tui-size" bindtap="collecting">
      <view :class="'van-icon'+(collected ? ' van-icon-goods-collect':' van-icon-goods-collect-o')" :style="'font-size:20px;color:'+(collected ? '#ff201f' : '#333')"></view>
      <view class="tui-scale-collection" :class="{'tui-icon-red':collected}">收藏</view>
    </view> -->
      </view>
      <view class="tui-pro-titbox">
        <view class="tui-pro-title">{{data.name}}</view>
      </view>
      <view class="tui-gray">
        <view class="tui-sub-title">{{data.specs}}</view>
        <view class="tui-sub-title" style="padding: 0;">{{data.company}}</view>
      </view>
    </view>
    <view class="page_share" bindtap="onShare">
      <view class="share-image">
        <image src="../../public/orther_img/share.png"></image>
      </view>
      <view class="share_text">分享</view>
    </view>
  </view>
</view>
<van-tabs active="{{ cont_index }}" sticky animated swipeable>
  <van-tab title="商品信息">
    <view class="cont">
      <view wx:if="{{data.name}}" class="goods_detail_box">
        <view class="goods_detail_table">
          <view class="goods_detail_td">商品编号</view>
          <view class="goods_detail_td">{{ data.goods_id }}</view>

          <view class="goods_detail_td">商品名称</view>
          <view class="goods_detail_td">{{ data.name }}</view>

          <view class="goods_detail_td">包装规格</view>
          <view class="goods_detail_td">{{ data.specs }}</view>

          <view class="goods_detail_td">生产企业</view>
          <view class="goods_detail_td">{{ data.company }}</view>

          <view class="goods_detail_td">生产日期</view>
          <view class="goods_detail_td">{{data.prod_date}}</view>

          <view class="goods_detail_td">有效期至</view>
          <view class="goods_detail_td">{{data.valid_date}}</view>

          <view class="goods_detail_td">单<text decode="{{true}}">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</text>位</view>
          <view class="goods_detail_td">{{data.unit}}</view>

          <view class="goods_detail_td">中包装数</view>
          <view class="goods_detail_td">{{data.mid_pack_num}}</view>

          <view class="goods_detail_td">大包装数</view>
          <view class="goods_detail_td">{{data.big_pack_num}}</view>

          <view class="goods_detail_td">批准文号</view>
          <view class="goods_detail_td">{{data.batch_number}}</view>
        </view>
      </view>
    </view>
  </van-tab>
  <van-tab title="商品详情">
    <view class="cont">
      <parser wx:if="{{data.content}}" html="{{data.content}}" bindready="cont_ready" />
      <!-- <rich-text nodes="{{data.content}}"></rich-text> -->
    </view>
  </van-tab>
  <van-tab title="说明书">
    <view class="cont">
      <view wx:if="{{data.content_list.length>0}}" class="tui-product-img">
        <block wx:for="{{data.content_list}}" wx:key='index'>
          <image src="{{item}}" bindtap="contPreviewImage" data-index="{{index}}" mode="widthFix" style="width:750rpx;">
          </image>
        </block>
      </view>
    </view>
  </van-tab>
</van-tabs>
<!-- <view style="margin:10rpx 0 2rpx;">
  <van-sticky bind:scroll="stickyScroll">
    <view style="display:flex;background-color:#fff;">
      <view class="tab_title{{cont_index==0?' active':''}}" bindtap="view_cont" data-i="0"><text>商品信息</text></view>
      <view class="tab_title{{cont_index==1?' active':''}}" bindtap="view_cont" data-i="1"><text>商品详情</text></view>
      <view class="tab_title{{cont_index==2?' active':''}}" bindtap="view_cont" data-i="2"><text>说明书</text></view>
    </view>
  </van-sticky>
</view>
<swiper class="tab_cont" style="height:{{cont_index==1?(cont_scroll_hei!=0?cont_scroll_hei:hei[cont_index]):hei[cont_index]}}px;" current="{{cont_index}}" bindchange="tab_change">
  <swiper-item>
    <view class="cont">
      <view class="goods_detail_box">
        <view class="goods_detail_table">
          <view class="goods_detail_td">商品编号</view>
          <view class="goods_detail_td">{{ data.goods_id }}</view>
          
          <view class="goods_detail_td">商品名称</view>
          <view class="goods_detail_td">{{ data.name }}</view>
          
          <view class="goods_detail_td">包装规格</view>
          <view class="goods_detail_td">{{ data.specs }}</view>
          
          <view class="goods_detail_td">生产企业</view>
          <view class="goods_detail_td">{{ data.company }}</view>
          
          <view class="goods_detail_td">生产日期</view>
          <view class="goods_detail_td">{{data.prod_date}}</view>
          
          <view class="goods_detail_td">有效期至</view>
          <view class="goods_detail_td">{{data.valid_date}}</view>
          
          <view class="goods_detail_td">单位</view>
          <view class="goods_detail_td">{{data.unit}}</view>
          
          <view class="goods_detail_td">中包装数</view>
          <view class="goods_detail_td">{{data.mid_pack_num}}</view>
          
          <view class="goods_detail_td">大包装数</view>
          <view class="goods_detail_td">{{data.big_pack_num}}</view>
          
          <view class="goods_detail_td">批准文号</view>
          <view class="goods_detail_td">{{data.batch_number}}</view>
        </view>
      </view>
    </view>
  </swiper-item>
  <swiper-item>
    <view class="cont">
      <parser html="{{data.content}}" bindready="cont_ready" />
      <rich-text nodes="{{data.content}}"></rich-text>
    </view>
  </swiper-item>
  <swiper-item>
    <view class="cont">
      <view wx:if="{{data.content_list.length>0}}" class="tui-product-img">
        <block wx:for="{{data.content_list}}" wx:key='index'>
          <image src="{{item}}" bindtap="contPreviewImage" data-index="{{index}}" mode="widthFix" style="width:750rpx;"></image>
        </block>
      </view>
    </view>
  </swiper-item>
</swiper> -->

<van-divider contentPosition="center">已经到最底了</van-divider>
<view class="bot_placeholder"></view>
<view class="qty_tip" wx:if="{{showTip}}">此商品无货，去挑选其他？</view>
<!-- 底部导航栏 -->
<van-goods-action>
  <van-goods-action-icon icon="chat-o" text="客服" open-type="contact" />
  <van-goods-action-icon icon="goods-collect-o" text="收藏" bind:click="doCollect" />
  <van-goods-action-icon icon="cart-o" text="购物车" bind:click="goCar" />
  <van-goods-action-button size="mini" text="加入购物车" type="warning" bind:click="showPopup" />
  <van-goods-action-button size="mini" text="立即下单" bind:click="showPopup" />
</van-goods-action>
<!-- 分享弹窗 -->
<van-popup show="{{ shareShow }}" round position="bottom" custom-style="height: 356rpx" bind:close="onClose">
  <view class="popup-box">
    <view class="wechat">
      <button open-type="share" hover-class="none">
        <view class="wechat-image">
          <image src="../../public/orther_img/wechat.png"></image>
        </view>
        <view class="wechat-text">分享给朋友</view>
      </button>
    </view>
    <view class="poster" wx:for="{{y_menus}}" wx:key="index" bindtap="onPoster" data-pid="{{item.title}}"
      data-indd="{{index}}">
      <view class="poster-image">
        <image src="{{item.icon}}"></image>
      </view>
      <view class="poster-text">{{item.title}}</view>
    </view>
    <!-- <view class="poster" bindtap='onPoster'>
      <view class="poster-image">
        <image src="../../public/orther_img/poster.png"></image>
      </view>
      <view class="poster-text">生成商品海报</view>
    </view>
    <view class="terminal" bindtap='onTerminal'>
      <view class="terminal-image">
        <image src="../../public/orther_img/terminal.png"></image>
      </view>
      <view class="terminal-text">生成终端海报</view>
    </view> -->
  </view>
  <view class="close-btn" bindtap="onClose">关闭</view>
</van-popup>
<!-- 分享朋友圈弹框 -->
<view class="tankuang" wx:if="{{showPoster}}">
  <view class="container">
    <view class="popupClose" bindtap="closeCanvas">关闭</view>
    <view class="canvasImg" bindtap="previewImg">
      <image style="width:100%;height:100%;" src="{{imagePath}}"></image>
    </view>
    <view class="popupTip">保存图片，叫伙伴们一起围观吧</view>
    <view class="saveBtn">
      <van-button round type="info" bindtap="saveCanvasImg">保存图片</van-button>
    </view>
  </view>
</view>
<!-- <canvas style="width:{{windowW}}px;height:{{windowH}}px;display:{{maskHidden==true?'none':''}}"
  canvas-id="mycanvas" /> -->
<canvas wx:if="{{shareTitle}}" style="width:{{windowW}}px;height:{{windowH}}px;display:{{maskHidden==true?'none':''}}"
  canvas-id="mycanvas" />
<canvas wx:else style="width:500px;height:870px;display:{{maskHidden==true?'none':''}}"
  canvas-id="mycanvas" />
<!-- 加入购物车、下单弹窗 -->
<van-popup show="{{ show }}" position="bottom" bind:close="closePopup" closeable round>
  <view class="tui-popup-box">
    <view class="tui-product-box tui-recommend">
      <view class="tui-popup-sub">猜您想要的产品</view>
      <view class="tui-product-box tui-goods">
        <image class="tui-popup-img" src="../../public/orther_img/produce_bg.png" />
        <view class="tui-popup-price">
          <view class="tui-popup-title">56333</view>
          <view class="tui-popup-title">清热消炎宁胶囊</view>
          <view class="tui-sub-title tui-size ">0.5g*36粒</view>
          <view class="tui-sub-title tui-size" style="padding: 0;">广东五虎山药业有限公司</view>
          <view class="tui-sub-title tui-pack"><text>中包装数：0</text><text style="padding-left:40rpx">大包装数：230</text>
          </view>
          <view class="tui-sub-title tui-startTime">生产日期：2020-06-20</view>
          <view class="tui-sub-title tui-endTime">有效日期：2022-06-20</view>
          <view class="tui-merge">
            <view class="tui-amount tui-bold">￥13.20</view>
            <view class="tui-button">
              <view class="tui-btn" style="margin-right:20rpx">收藏</view>
              <view class="tui-btn">下单</view>
            </view>
          </view>
        </view>
      </view>
      <view class="sales_info_box" style="margin:20rpx 0">
        <view class="sales_info_left">
          <view class="sales_info_icon">买赠</view>
        </view>
        <view class="sales_info_cont">10瓶送1瓶</view>
        <view class='tui-countdown-content'>
          <van-count-down time="{{time}}" format="剩余:DD天HH时mm分ss秒" />
        </view>
      </view>
    </view>
    <view class="tui-product-box tui-padding">
      <image class="tui-popup-img" src="{{data.img}}" />
      <view class="tui-popup-price">
        <view class="tui-pro-title">{{data.goods_id}}</view>
        <view class="tui-pro-title">{{data.name}}</view>
        <view class="tui-sub-title tui-size">{{data.specs}}</view>
        <view class="tui-sub-title tui-size" style="padding: 0;">{{data.company}}</view>
        <view class="tui-sub-title tui-pack">中包装数：{{ data.mid_pack_num }}<text
            style="padding-left:40rpx">大包装数：{{ data.big_pack_num }}</text></view>
        <view class="tui-sub-title tui-startTime">生产日期：{{ data.prod_date }}</view>
        <view class="tui-sub-title tui-endTime">有效日期：{{ data.valid_date }}</view>
        <view class="tui-amount tui-bold">￥{{data.priceLeft}}.{{data.priceRight}}</view>
        <!-- <view class="tui-number">编号:4373299399393</view> -->
      </view>
    </view>
    <view wx:if="{{content}}" class="sales_info_box {{endTime<1000 ? 'on' : ''}}">
      <view class="sales_info_left">
        <view class="sales_info_icon">买赠</view>
      </view>
      <view class="sales_info_cont">{{content}}</view>
      <view class='tui-countdown-content'>
        <van-count-down time="{{ endTime }}" format="剩余:DD天HH时mm分ss秒" />
      </view>
    </view>
    <view class="tui-scrollview-box">
      <view class="tui-number-box">
        <view>数量</view>
        <van-stepper value="{{ car_num }}" min="1" integer bind:change="numChange" />
      </view>
    </view>
    <view class="tui-operation tui-operation-right tui-right-flex tui-popup-btn">
      <view class="tui-flex-1">
        <van-button custom-style="width:100%;font-size:28rpx;height:68rpx;" round type="warning" bindtap="addToCar">
          加入购物车</van-button>
      </view>
      <view class="tui-flex-1">
        <van-button custom-style="width:100%;font-size:28rpx;height:68rpx;" round type="danger" bindtap="goBuy">立即下单
        </van-button>
      </view>
    </view>
  </view>
</van-popup>